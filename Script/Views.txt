-- View que apresenta o total gasto em compras por fornecedor
CREATE OR REPLACE VIEW vw_gasto_por_fornecedor AS
SELECT 
    F.NOME_EMPRESA,
    SUM(P.CUSTO_TOTAL) AS TOTAL_GASTO
FROM PEDIDOS_COMPRA P
JOIN FORNECEDORES F ON P.ID_FORNECEDOR = F.ID_FORNECEDOR
GROUP BY F.NOME_EMPRESA;

-- View que apresenta o gasto total agrupado por mÃªs e ano
CREATE OR REPLACE VIEW vw_gasto_mensal AS
SELECT 
    YEAR(DATA_PEDIDO) AS ANO,
    MONTH(DATA_PEDIDO) AS MES,
    SUM(CUSTO_TOTAL) AS TOTAL_GASTO
FROM PEDIDOS_COMPRA
GROUP BY ANO, MES
ORDER BY ANO, MES;

-- View que mostra o total gasto por departamento requisitante
CREATE OR REPLACE VIEW vw_gasto_por_departamento AS
SELECT 
    S.DEPARTAMENTO,
    SUM(P.CUSTO_TOTAL) AS TOTAL_GASTO
FROM PEDIDOS_COMPRA P
JOIN SOLICITANTES S ON P.ID_SOLICITANTE = S.ID_SOLICITANTE
GROUP BY S.DEPARTAMENTO
ORDER BY TOTAL_GASTO DESC;

-- View detalhada de todos os pedidos de compra, relacionando solicitante, fornecedor, produto, local e status
CREATE OR REPLACE VIEW vw_pedidos_detalhados AS
SELECT 
    P.ID_PEDIDO_COMPRA,
    P.DATA_PEDIDO,
    F.NOME_EMPRESA,
    PS.DESCRICAO AS PRODUTO,
    S.NOME AS SOLICITANTE,
    S.DEPARTAMENTO,
    L.DESCRICAO_LOCAL AS LOCAL_ENTREGA,
    P.QUANTIDADE,
    P.PRECO_UNITARIO,
    P.CUSTO_TOTAL,
    P.STATUS_PEDIDO
FROM PEDIDOS_COMPRA P
JOIN FORNECEDORES F ON P.ID_FORNECEDOR = F.ID_FORNECEDOR
JOIN PRODUTOS_SERVICOS PS ON P.ID_PRODUTO = PS.ID_PRODUTO
JOIN SOLICITANTES S ON P.ID_SOLICITANTE = S.ID_SOLICITANTE
JOIN LOCAIS_ENTREGA L ON P.ID_LOCAL_ENTREGA = L.ID_LOCAL;